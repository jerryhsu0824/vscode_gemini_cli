### **個人資產管理系統 產品需求文件 (PRD)**

#### **1. 目標與背景**

**1.1. 目標**

*   **即時總覽**：提供一個統一的儀表板，即時計算並展示所有個人資產（存款、台股、美股）的總價值。
*   **績效分析**：能夠分析整體投資組合的表現，並計算關鍵指標，如報酬率、損益等。
*   **趨勢追蹤**：以視覺化圖表（如趨勢圖）呈現個人總資產隨時間變化的歷史軌跡。
*   **歷程記錄**：保留完整的投資交易歷史（買入、賣出），以便回顧與查詢。

**1.2. 背景**

目前，資產管理分散在 Excel 表格和多個金融 App 之間，導致資訊整合困難且耗時。使用者無法一目了然地掌握即時的總資產狀況，也難以對分散的投資進行統一的績效評估。本系統旨在解決此核心痛點，透過自動化和集中化的方式，提供一個單一、可靠的資產資訊來源，從而節省時間並提供更清晰的財務洞察。

**1.3. 文件變更紀錄**

| 日期 | 版本 | 描述 | 作者 |
| :--- | :--- | :--- | :--- |
| 2025-09-17 | 1.0 | 初始草案：定義專案目標與背景 | John |
| 2025-09-17 | 2.0 | 完成所有功能、技術、UI規劃與史詩定義 | John |

---

### **2. 需求**

#### **2.1. 功能性需求 (最終版)**

*   **FR1:** 系統必須能夠整合多種資產類別（個人存款、台股、美股），並在單一儀表板上顯示即時的總資產價值。
*   **FR2:** 系統需提供投資組合分析功能，計算並顯示整體與個別資產的報酬率、損益金額等績效指標。
*   **FR3:** 系統應提供歷史趨勢圖，以視覺化方式呈現總資產在不同時間區間（如：週、月、年）的變化。
*   **FR4:** 系統必須記錄所有投資標的之交易歷史，包括買入/賣出日期、價格與數量，並提供查詢功能。
*   **FR5 (已更新):** 系統需提供一個目標導向的退休金規劃工具。使用者可以設定一個退休金目標總額，系統將根據使用者投資組合的 **歷史平均年化報酬率**，計算出預計還需要 **多少時間** 才能達成該目標。
*   **FR6 (新增):** 在投資組合分析頁面，系統需提供一個顯示各類資產（如：台股、美股、存款）佔總資產 **配置比例** 的圖表（例如：圓餅圖）。
*   **FR7 (已更新):** 使用者可以為其投資組合中的**特定資產**（如 QQQ）設定目標佔比。當該資產的實際比例因市場波動而偏離目標（例如，設定佔比 30%，偏離值 10%，當實際佔比超過 40% 或低於 20%）時，系統應發出「再平衡提醒」。
*   **FR8 (已更新):** 系統需提供「投資組合健康度」分析功能，計算並顯示多種行業標準指標（如：**夏普值 Sharpe Ratio、Sortino 比例、標準差**等），以提供更全面的投資組合風險與回報評估。
*   **FR9 (新增):** 系統必須能夠自動獲取即時匯率（例如：USD to TWD），以便將所有外幣資產換算成台幣進行計算與顯示。

#### 2.2. 功能優先順序 (MoSCoW)

*   **M (Must-have) - 必須擁有**
    *   FR1: 即時總資產價值
    *   FR2: 投資組合績效分析
    *   FR4: 投資交易歷史紀錄
    *   FR9: 貨幣轉換
*   **S (Should-have) - 應該擁有**
    *   FR3: 總資產歷史趨勢圖
    *   FR5: 目標導向的退休金規劃
    *   FR6: 資產配置比例圖
*   **C (Could-have) - 可以擁有**
    *   FR7: 再平衡提醒
    *   FR8: 投資組合健康度分析 (夏普值)
    *   投資組合模擬器
*   **W (Won't-have) - 這次不會有**

#### 2.3. 假設與限制

*   **限制 - 計價貨幣：** 所有系統內的計算與顯示，都必須以**台幣 (TWD)** 作為統一的基礎貨幣。
*   **限制 - 資料來源與風險：**
    *   **來源指定：** 美股使用 `yfinance` 函式庫；台股使用證交所網站 `STOCK_DAY` URL；匯率使用央行 `BP01D01` API。
    *   **風險評估：** 上述 `yfinance` 與證交所來源並非正式 API，穩定性較差，可能因網站改版或反抓取機制而失效。
    *   **應對策略：** 開發時必須採用「**模組化連接器**」設計，將各個資料來源的程式碼獨立封裝，以便在某個來源失效時，能快速替換成新的來源，而無需修改系統核心邏輯。
*   **限制 - 語言與框架：** 專案後端將使用 **Python** (搭配 **FastAPI** 框架) 進行開發，前端則使用 **React** 框架。
*   **限制 - 資料儲存：** 系統將使用 **SQLite** 作為其資料庫，以單一檔案 (`database.db`) 的形式儲存所有交易紀錄與使用者資料。
*   **限制 - 前後端溝通：** 後端排程任務完成計算後，會將所有前端需要的顯示資料寫入一個靜態的 `results.json` 檔案。前端應用程式僅需讀取此檔案來呈現介面，無需直接與後端 API 溝通。
*   **限制 - 部署環境：** 應用程式的最終運行環境被指定為 **Synology DS720+ NAS 上的 Docker 容器**。
*   **限制 - 服務模式：** 系統將以**排程方式定時運行**（例如每日批次處理），而非 24/7 全時線上服務。
*   **限制 - 資料輸入：** 系統初版將完全依賴**手動輸入**交易資料。
*   **限制 - 效能策略：** 為了優化使用者體驗，系統將採用「資料預先下載，即時分析」的模式。
*   **限制 - 安全性：** 由於是個人在本機環境使用，目前沒有特殊的資料加密或進階安全要求。
*   **假設 - 公式標準化：** 系統中的所有財務指標（如夏普值）將使用公開、標準的計算公式，不涉及客製化的複雜金融模型。

---

### **3. 使用者介面設計目標**

#### **3.1. 整體 UX 願景**
打造一個現代、簡潔、以數據為中心的儀表板介面。核心目標是將複雜的個人財務數據轉化為直觀、一目了然的視覺化資訊，讓使用者能快速掌握資產狀況並從中獲得洞見。

#### **3.2. 關鍵互動模式**
*   **主儀表板 (Dashboard):** 作為系統首頁，提供最重要的資訊總覽。
*   **下鑽分析 (Drill-down):** 使用者可以從儀表板上的摘要資訊點擊，深入查看特定資產、報表或圖表的詳細內容。
*   **表單輸入 (Form Entry):** 提供簡單、易於使用的表單來手動輸入交易紀錄。

#### **3.3. 核心畫面與視圖**
*   **主控台 (Dashboard):** 顯示總資產價值 (FR1)、資產趨勢圖 (FR3) 和資產配置圖 (FR6)。
*   **投資組合分析頁:** 提供詳細的績效指標 (FR2) 和投資組合健康度分析 (FR8)。
*   **交易歷史頁:** 可查詢、篩選所有歷史交易紀錄 (FR4)。
*   **退休計畫頁:** 包含退休金目標設定與達成時間計算 (FR5)。
*   **設定頁:** 用於管理提醒功能 (如 FR7 再平衡提醒) 及其他系統設定。

#### **3.4. 無障礙設計: WCAG AA**
我們將以 WCAG AA 作為無障礙設計的標準，確保介面對所有使用者都足夠友好。

#### **3.5. 品牌與風格**
目前假設沒有特定的品牌要求，將專注於創造一個乾淨、專業、易於閱讀的現代化設計風格。

#### **3.6. 目標裝置與平台: Web Responsive (響應式網頁)**
系統將作為一個響應式網站來開發，確保在桌面電腦和行動裝置的瀏覽器上都有良好的使用體驗。

#### **3.7. 概念線框圖 (Conceptual Wireframe)**

##### **畫面一：主控台 (Dashboard)**
```
+----------------------------------------------------------------------+
| [頁首 Header: Logo/應用程式名稱] [導覽列: 主控台 | 分析 | 歷史 | 退休 | 設定] |
+----------------------------------------------------------------------+
|                                                                      |
|  [醒目的大數字]                                                        |
|  總資產價值: $1,234,567.89 (今日漲跌: +$5,678)                      |
|                                                                      |
+----------------------------------------------------------------------+
|                                                                      |
|  [左半部: 總資產歷史趨勢圖 (FR3)]                                      |
|  (一個線形圖，X軸為時間，Y軸為金額)                                  |
|                                                                      |
+----------------------------------------------------------------------+
|                                                                      |
|  [右半部: 資產配置比例圖 (FR6)]                                        |
|  (一個圓餅圖，顯示台股/美股/存款等各佔比)                            |
|                                                                      |
+----------------------------------------------------------------------+
```

##### **畫面二：投資組合分析頁 (Portfolio Analysis)**
```
+----------------------------------------------------------------------+
| [頁首 Header & 導覽列]                                               |
+----------------------------------------------------------------------+
|                                                                      |
|  [頂部摘要區]                                                          |
|  整體投報率: 15.2% | 夏普值: 1.8 | 標準差: 12% ... (FR8)          |
|                                                                      |
+----------------------------------------------------------------------+
|                                                                      |
|  [資產列表 (表格)]                                                                        |
|  | 標的   | 庫存股數 | 標的價格 | 標的市值 | 標的市值(台幣) |
|  |--------|----------|----------|----------|----------------|
|  | QQQ    | 100      | $400     | $40,000  | NT$1,280,000   |
|  | 0050   | 2000     | NT$150   | NT$300,000| NT$300,000     |
|                                                                      |
+----------------------------------------------------------------------+
```

##### **畫面三：交易歷史頁 (Transaction History)**
```
+----------------------------------------------------------------------+
| [頁首 Header & 導覽列]                                               |
+----------------------------------------------------------------------+
|                                                                      |
|  [篩選/搜尋區]                                                         |
|  資產名稱: [輸入框] | 日期範圍: [日期選擇器] | [搜尋按鈕] [新增交易按鈕] |
|                                                                      |
+----------------------------------------------------------------------+
|                                                                      |
|  [交易列表 (表格)] (FR4)                                               |
|  | 日期       | 資產名稱 | 類型 | 價格   | 數量   |                   |
|  |------------|----------|------|--------|--------|-------------------|
|  | 2025-09-15 | 台積電   | 買入 | $600   | 1000股 | [編輯] [刪除]     |
|  | 2025-09-10 | SPY      | 賣出 | $450   | 50股   | [編輯] [刪除]     |
|                                                                      |
+----------------------------------------------------------------------+
```

##### **畫面四：退休計畫頁 (Retirement Plan)**
```
+----------------------------------------------------------------------+
| [頁首 Header & 導覽列]                                               |
+----------------------------------------------------------------------+
|                                                                      |
|  [輸入區]                                                              |
|  我的退休目標金額: [ $1,000,000 ]                                    |
|  預期年化報酬率: [ 8 ] % (系統可帶入歷史平均值)                      |
|  每月預計投入: [ $1,000 ]                                            |
|  [計算按鈕]                                                          |
|                                                                      |
+----------------------------------------------------------------------+
|                                                                      |
|  [結果顯示區] (FR5)                                                    |
|  距離達成目標還需要：**15 年 8 個月**                                  |
|  (下方可搭配一個簡單的資產成長曲線圖)                                |
|                                                                      |
+----------------------------------------------------------------------+
```

#### 3.8. 使用者故事地圖 (User Story Map)

**主題 (Epic):** 作為一個使用者，我想要了解我整體投資組合的現況與表現，以便我能做出明智的判斷。

**故事流程 (User Journey):**

1.  **故事 1: 快速總覽**
    *   **身為** 一個使用者，
    *   **我想要** 打開應用程式後，立刻在 **主控台 (Dashboard)** 上看到我的總資產淨值和近期走勢，
    *   **以便** 我能快速掌握現況。
    *   *(對應畫面: 主控台)*

2.  **故事 2: 檢視配置**
    *   **身為** 一個使用者，
    *   **我想要** 在主控台上查看 **資產配置比例圖**，
    *   **以便** 我了解我的投資組合是否依然符合我預期的平衡策略。
    *   *(對應畫面: 主控台)*

3.  **故事 3: 深入分析**
    *   **身為** 一個使用者，
    *   **我想要** 點擊導覽列的「分析」按鈕，前往 **投資組合分析頁**，
    *   **以便** 我查看更詳細的績效指標。
    *   *(對應畫面: 投資組合分析頁)*

4.  **故事 4: 評估健康度**
    *   **身為** 一個使用者，
    *   **我想要** 在分析頁的頂部看到如 **夏普值** 等關鍵指標，
    *   **以便** 我評估我承擔的風險是否帶來了值得的回報。
    *   *(對應畫面: 投資組合分析頁)*

5.  **故事 5: 新增一筆交易**
    *   **身為** 一個使用者，
    *   **我想要** 在 **交易歷史頁** 上點擊「新增交易」按鈕，並在跳出的表單中填寫股票代碼、日期、類型、價格、數量以及**券商**資訊，
    *   **以便** 我能準確地記錄我的投資活動，並在儲存後立即看到我的**總資產價值**得到更新。
    *   *(對應畫面: 交易歷史頁, 新增交易表單)*

6.  **故事 6: 修正錯誤紀錄**
    *   **身為** 一個使用者，
    *   **我想要** 在 **交易歷史頁** 上，當我發現一筆錯誤的紀錄時，可以直接點擊該筆紀錄旁邊的「編輯」或「刪除」按鈕，
    *   **以便** 我能即時修正錯誤，確保我的資產數據永遠是準確的。
    *   *(對應畫面: 交易歷史頁)*

7.  **故事 7: 設定並接收再平衡提醒**
    *   **身為** 一個使用者，
    *   **我想要** 在 **設定頁** 上，設定我理想的**單一資產**佔比（例如：QQQ 目標 30%，偏離值 10%），
    *   **接著**，如果市場波動導致該資產的實際比例超過 40% 或低於 20% 時，我希望能收到一個明確的警示，
    *   **以便** 我能注意到風險並考慮是否需要進行再平衡操作。
    *   *(對應畫面: 設定頁, 主控台上的警示訊息)*

---

### **6. 史詩細節：史詩 1 - 核心數據基礎與顯示**

**擴充目標:** 本史詩的目標是建立整個專案的技術骨架，並交付一個最小但完全可用的產品 (MVP)。完成後，使用者將能夠手動建立自己的投資組合資料庫，並透過網頁介面查看以台幣計價的總資產和各項資產的即時市值。

---
#### **故事 1.1: 專案初始化與資料庫設定**
*   **身為** 一個開發者，
*   **我想要** 建立 Python/React 的專案資料夾結構、設定好開發環境，並初始化一個空的 SQLite 資料庫檔案，
*   **以便** 我有一個穩固的基礎來開始開發後續功能。

**驗收標準:**
1.  程式碼倉儲中存在定義好的前端和後端資料夾。
2.  後端環境 (Python) 的依賴套件 (如 FastAPI, pandas, yfinance) 已被定義。
3.  前端環境 (React) 的標準專案結構已建立。
4.  一個名為 `database.db` 的空 SQLite 檔案被建立。

---
#### **故事 1.2: 核心交易紀錄管理**
*   **身為** 一個使用者，
*   **我想要** 一個介面來手動新增、編輯和刪除我的每一筆交易紀錄，
*   **以便** 我能建立並維護一個準確的持股資料庫。

**驗收標準:**
1.  在「交易歷史頁」上，有一個「新增交易」的按鈕。
2.  點擊按鈕後，會出現一個表單，包含欄位：股票代碼、交易日期、買/賣、價格、數量、券商。
3.  提交表單後，該筆交易紀錄會被正確地儲存到 SQLite 資料庫中。
4.  在「交易歷史頁」的列表上，每一筆紀錄旁都有「編輯」和「刪除」按鈕，且功能運作正常。

---
#### **故事 1.3: 後端排程計算引擎**
*   **身為** 一個系統，
*   **我想要** 依排程自動運行，讀取資料庫中的所有交易，並透過 API 獲取最新的股價和匯率，
*   **以便** 我能計算出每項資產的即時市值（換算為台幣）和基礎的績效指標，並將結果寫入 `results.json` 檔案。

**驗收標準:**
1.  腳本可以成功讀取 SQLite 資料庫中的所有交易。
2.  腳本可以成功地從 `yfinance`、證交所網址和央行 API 獲取資料。
3.  對於美元資產，腳本能正確地將其價格和市值換算成台幣。
4.  腳本會生成一個 `results.json` 檔案，其中包含所有資產的列表，且每個資產都有「標的市值(台幣)」和「報酬率」等欄位。

---
#### **故事 1.4: 前端核心數據展示**
*   **身為** 一個使用者，
*   **我想要** 打開網頁介面時，能看到一個顯示總資產（台幣）的醒目數字，以及一個列出我所有資產明細的表格，
*   **以便** 我能一目了然地掌握我的財務狀況。

**驗收標準:**
1.  前端應用程式能成功讀取 `results.json` 檔案。
2.  「主控台」頁面上方會顯示一個加總所有資產市值後的「總資產價值」。
3.  「投資組合分析頁」上會顯示一個表格，其欄位和內容與我們在線框圖中定義的「資產列表」完全一致。